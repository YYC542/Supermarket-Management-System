name: CI Pipeline - Lint and Test

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install linting tools
        run: |
          python -m pip install --upgrade pip
          pip install flake8 pylint
      
      - name: Run flake8
        run: |
          echo "Running flake8..."
          flake8 src/ tests/ --count --select=E9,F63,F7,F82 --show-source --statistics || true
          flake8 src/ tests/ --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
        continue-on-error: true
      
      - name: Run pylint
        run: |
          echo "Running pylint..."
          pylint src/ --exit-zero --max-line-length=127 || true
        continue-on-error: true

  test-unit:
    name: Unit Tests
    runs-on: ubuntu-latest
    needs: lint
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest pytest-cov
      
      - name: Run unit tests for Product module
        run: |
          echo "Testing Product module..."
          pytest tests/test_sample.py -v --tb=short
      
      - name: Run unit tests for Sales module
        run: |
          echo "Testing Sales module..."
          pytest tests/test_sales.py -v --tb=short
      
      - name: Generate test coverage report
        run: |
          pytest tests/test_sample.py tests/test_sales.py --cov=src --cov-report=term || true
        continue-on-error: true

  test-integration:
    name: Integration Tests
    runs-on: ubuntu-latest
    needs: test-unit
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest
      
      - name: Run integration tests
        run: |
          echo "Running integration tests..."
          pytest tests/test_integration.py -v --tb=short
      
      - name: Display test summary
        if: always()
        run: |
          echo "================================"
          echo "Test execution completed!"
          echo "================================"

  build-summary:
    name: Build Summary
    runs-on: ubuntu-latest
    needs: [lint, test-unit, test-integration]
    if: always()
    
    steps:
      - name: Check overall status
        run: |
          echo "================================"
          echo "CI Pipeline Summary"
          echo "================================"
          echo "Code linting: Completed"
          echo "Unit tests: Completed"
          echo "Integration tests: Completed"
          echo "================================"
          echo "All checks completed!"
          echo "================================"
```

7. **Commit message 输入**：
```
fix: correct YAML syntax in CI workflow file
